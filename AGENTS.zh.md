# AGENTS.zh.md

## 0. 任务目标
你是本仓库的执行者（executor）。目标是把 RoboTwin 2.0 的全流程跑通并可迭代：
**数据采集 → 数据处理 → 训练 → 评估**，直到工作正常。

policy的选择默认使用ACT，除非有其他相关要求

本仓库是研究/工程代码，示例与指令可能不完整甚至有误。
遇到错误时允许你**自主探索、排查与修复**。推荐采用渐进式调试：
先做最小化 smoke test，再逐步扩大规模。

---

### 0.1 项目文档入口（请先阅读/按需查阅）
为避免本文件过长，详细说明与导航已拆分到 `docs/`：

- **执行手册（Playbook）**：`docs/codex_playbook.md`  
  包含：RUNID/记录模板、nohup 建议、调试顺序与常用自检命令。

- **流水线导航图（Pipeline Map）**：`docs/robowin_pipeline_map.md`  
  包含：RoboTwin 2.0 流水线各阶段（采集/处理/训练/评估）的入口线索、关键配置位置提示、产物定位要点，以及如何用 `rg/find` 快速定位入口。


## 1. 不可协商的安全规则（硬约束）
1) **禁止 sudo**：不得执行 `sudo` 或任何需要提权的命令

2) **禁止危险/破坏性命令**（及其等价行为），包括但不限于：
- 对宽路径/上层目录执行 `rm -rf`（如仓库根目录、父目录、`~`、`/`，或包含大量通配符的删除）
- `mkfs`、`dd`、磁盘/分区工具
- `chmod -R`、`chown -R`
- 使用 `> 某文件` 覆盖未知文件（除非该文件是你在本次 run 中新建的）

3) **不得修改任何“本次开始前就存在”的文件**（即 pre-existing files）。
- 允许：新建文件/目录；复制旧文件得到新文件；只编辑新文件。
- 如果必须“改变调用关系/入口”，请通过**新建 wrapper 脚本/新建配置入口**来实现，然后只运行 wrapper。

如何在不改旧文件的前提下修改行为：
不要编辑任何已有文件。若需要修改某个被调用的脚本/配置，请先复制出一个带 RUNID 后缀的新文件并修改它；然后再复制上游的调用脚本/入口文件，改成引用这个新文件。
例如：原来 c.sh -> a.py，则创建 b.py（由 a.py 复制并修改），再创建 d.sh（由 c.sh 复制并改为调用 b.py）。这样满足“旧文件不变，只新增新文件”的要求。

4) **不得越界到仓库之外**。
- 不得读写本仓库以外路径（例如 `/etc`、`~/.ssh`、系统目录、其他仓库）。
- Web 检索仅通过内置搜索工具；关键结论必须落盘缓存（见下文）。

---

## 2. RUN 流程规范（推荐遵守）
每次 run 开始时生成 RUNID：
- 格式：`YYYYMMDD_HHMMSS`（UTC+8）
- 所有本次新建文件都必须带 RUNID 后缀，例如：`*_RUNID.*` 或 `*__rRUNID.*`，方便追踪与 grep。

你必须产出两类记录：

### 2.1 Worklog（必须）
在仓库根目录创建并持续更新：`worklog_<RUNID>.md`  
必须包含：
- 目标与约束（task、指标、资源）
- 实际执行的命令（原样粘贴）
- 新建的文件/目录清单（路径 + 用途）
- nohup 时的日志路径与 PID
- 产物位置：raw data / processed_data / ckpt / eval 输出等

### 2.2 Web 检索缓存（推荐做法）
在 `docs/cache/` 下至少创建一个缓存文件，例如：
- `docs/cache/web_refs_<RUNID>.md`

如果内容较多，允许拆分多个文件，例如：
- `docs/cache/web_refs_<RUNID>_01.md`
- `docs/cache/web_refs_<RUNID>_02.md`

每个缓存文件应包含：
- 链接 + 简短笔记
- 解决了什么问题 / 对应哪个报错
- 实际采用的命令/配置片段（如有）

### 2.3 下载

请注意，当前的环境已经基本部署完毕，能够运行RoboTwin 2.0的ACT和DP的全流程

所以，大部分情况下，你可能不需要重新的按RoboTwin 2.0文档描述的一样，下载所有的环境和资产

你可以先尝试运行，使用我的环境

当前环境是conda环境aml

激活环境：

```bash
conda activate aml
```

一般的讲，我在让你工作之前，会先激活环境。你可以直接使用

---

## 3. 长时间运行（推荐做法）
该流水线可能持续数小时。为增强稳定性，推荐：
- 对耗时训练/评估使用 `nohup` 后台运行。
- 把 nohup 命令、日志路径、PID 写入 `worklog_<RUNID>.md`。
- 用 `tail -f <log>` 或 `grep` 定期检查是否正常推进。

---

## 4. 推荐自检（推荐做法）
建议经常自检，确保没有修改旧文件：
- `git status --porcelain`
- `git diff --name-only`
- `git diff`（确认没有 edits）
- `git ls-files --others --exclude-standard`（列出新增文件）

若发现改动了旧文件：立刻停止，撤销该修改，然后用“复制副本 + wrapper”的方式重新做。

